function Geolocator(t){this.status=-1,this.error="",this.watcher={count:0,first:{},last:{},id:null},this.moving={status:!1,speed:0,bearing:[],callbacks:{},waypoints:[],check:0,getDistance:function(){for(var t=0,o=1;o<this.waypoints.length;o++)t+=parseFloat(calculateDistance(this.waypoints[o-1].position.coords.latitude,this.waypoints[o-1].position.coords.longitude,this.waypoints[o].position.coords.latitude,this.waypoints[o].position.coords.longitude));return t},getAveSpeed:function(){for(var t,o,i=0,n=parseFloat(0),e=1;e<this.waypoints.length;e++)"undefined"!=typeof this.waypoints[e].speed&&this.waypoints[e].speed>0&&(n+=parseFloat(this.waypoints[e].speed),i++);return this.getCompleteTime()>0&&(o=this.getDistance()/(this.getCompleteTime()/1e3/60/60),t=parseFloat(calculateDistance(this.waypoints[0].position.coords.latitude,this.waypoints[0].position.coords.longitude,this.waypoints[this.waypoints.length-1].position.coords.latitude,this.waypoints[this.waypoints.length-1].position.coords.longitude))/(this.getCompleteTime()/1e3/60/60)),i>0?(n/i+o+t)/3:0},getCompleteTime:function(){return this.waypoints[this.waypoints.length-1].position.timestamp-this.waypoints[0].position.timestamp}},this.moving.callbacks.position=t&&t.moving&&t.moving.callbacks&&t.moving.callbacks.position||null,this.moving.callbacks.isMoving=t&&t.moving&&t.moving.callbacks&&t.moving.callbacks.isMoving||null,this.moving.callbacks.isStandStill=t&&t.moving&&t.moving.callbacks&&t.moving.callbacks.isStandStill||null,this.options=t||{},this.options.positionOptions=t&&t.positionOptions||{},this.options.error=t&&t.error||{},this.options.positionOptions.enableHighAccuracy=t&&t.positionOptions&&t.positionOptions.enableHighAccuracy||!0,this.options.positionOptions.timeout=t&&t.positionOptions&&t.positionOptions.timeout||1/0,this.options.positionOptions.maximumAge=t&&t.positionOptions&&t.positionOptions.maximumAge||0,this.init()}function calculateDistance(t,o,i,n){var e=6371,s=(i-t).toRad(),a=(n-o).toRad(),c=Math.sin(s/2)*Math.sin(s/2)+Math.cos(t.toRad())*Math.cos(i.toRad())*Math.sin(a/2)*Math.sin(a/2),r=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),l=e*r;return l}function bearingTo(t,o,i,n){var e=t.toRad(),s=i.toRad(),a=(n-o).toRad(),c=Math.sin(a)*Math.cos(s),r=Math.cos(e)*Math.sin(s)-Math.sin(e)*Math.cos(s)*Math.cos(a),l=Math.atan2(c,r);return(l.toDeg()+360)%360}Geolocator.prototype.init=function(){if(navigator.geolocation){this.status=1;var t=this;navigator.geolocation.getCurrentPosition(function(o){t.watcher.first=o,t.watcher.last=o,t.moving.waypoints[t.watcher.count]={position:o},"function"==typeof this.moving.callbacks.position&&this.moving.callbacks.position(o)},function(o){switch(t.error=o,o.code){case 1:"function"==typeof t.options.error.pmDenied&&t.options.error.pmDenied(o);break;case 2:"function"==typeof t.options.error.posUnavailable&&t.options.error.posUnavailable(o);break;case 3:"function"==typeof t.options.error.posUnavailable&&t.options.error.posUnavailable(o)}"function"==typeof t.options.error["default"]&&t.options.error["default"](o)},this.options.positionOptions),this.watcher.id=t.addWatcher(t.collectData),this.status=2}else this.status=0},Geolocator.prototype.addWatcher=function(t,o){var i=this;return navigator.geolocation?navigator.geolocation.watchPosition(function(o){t(o,i)},function(t){},i.options.positionOptions):void 0},Geolocator.prototype.collectData=function(t,o){var i=0;o.watcher.count++,document.getElementById("watching").innerHTML="Watching "+o.watcher.count+": "+Number(t.coords.latitude).toFixed(4)+","+Number(t.coords.longitude).toFixed(4),document.getElementById("distance").innerHTML="Distance: "+Number(o.moving.getDistance()).toFixed(3)+"km",document.getElementById("time").innerHTML="Time: "+Number((t.timestamp-o.watcher.first.timestamp)/1e3).toFixed(3)+"s";var n=Number(calculateDistance(o.watcher.last.coords.latitude,o.watcher.last.coords.longitude,t.coords.latitude,t.coords.longitude)).toFixed(6),e=Number((t.timestamp-o.watcher.last.timestamp)/1e3).toFixed(6);e=e/60/60,e&&(i=n/e,console.log("Distance: "+n),console.log("Speed: "+i+"km/h"),document.getElementById("speed").innerHTML="Speed: "+Number(i).toFixed(3)+" km/h",o.moving.speed=i);var s=document.getElementById("bearing").innerHTML,a=bearingTo(o.watcher.last.coords.latitude,o.watcher.last.coords.longitude,t.coords.latitude,t.coords.longitude);document.getElementById("bearing").innerHTML=s+", "+a,o.moving.waypoints[o.watcher.count]={position:t,distance:n,time:e,speed:i,bearing:a},o.checkMoving(),o.last=t},Geolocator.prototype.checkMoving=function(t){if(0===this.moving.check){var o=this,i=0,n=(Date.now(),0);this.moving.check=2;var e=setInterval(function(){i++,n=o.getBearingMax(),7===i&&(o.moving.getDistance()>0&&n>0&&30>n?("function"==typeof o.moving.callbacks.isMoving&&o.moving.callbacks.isMoving(o.moving),document.getElementById("move").innerHTML="Moving: (BearingMax: "+n+" Speed: "+o.moving.getAveSpeed()+")",o.moving.status=1):("function"==typeof o.moving.callbacks.isStandStill&&o.moving.callbacks.isStandStill(o.moving),document.getElementById("move").innerHTML="Stand still! (BearingMax: "+n+" )",o.moving.status=0),o.moving.check=1,navigator.geolocation.clearWatch(o.watcher.id),clearInterval(e))},1e3)}return 2},Geolocator.prototype.getBearingMax=function(){for(var t=0,o=1;o<this.moving.waypoints.length;o++)if(this.moving.waypoints[o-1].bearing>0){var i=Math.abs(this.moving.waypoints[o-1].bearing-this.moving.waypoints[o].bearing);i>0&&i>t&&(t=i)}return t},Number.prototype.toRad=function(){return this*Math.PI/180},Number.prototype.toDeg=function(){return this*(180/Math.PI)};
